(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[905],{332:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(1373);let i=(0,s.Z)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},5840:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/questionnaire",function(){return n(9331)}])},9520:function(e,t,n){"use strict";var s=n(5893);n(7294),t.Z=e=>{let{title:t,backBtn:n=!1}=e;return(0,s.jsxs)("nav",{className:"relative px-6 py-2",children:[n&&(0,s.jsx)("button",{type:"button",className:"absolute left-0 top-2",onClick:()=>{window.history.back()},children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:[(0,s.jsx)("path",{d:"M12.7574 7.90662L4.66406 16L12.7574 24.0933",stroke:"#191D31",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M27.3306 16H4.89062",stroke:"#191D31",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)("h1",{className:"text-center",children:t})]})}},6897:function(e,t,n){"use strict";var s=n(5893);n(7294);var i=n(512);t.Z=e=>{let{title:t,type:n="button",onClick:l,disabled:r=!1,classes:o=""}=e;return(0,s.jsx)("button",{onClick:e=>{null==l||l(e)},type:n,disabled:r,className:(0,i.Z)("rounded-[24px] px-6 py-3 text-[16px] font-semibold text-center leading-[1.3]",r?"text-gray-400 border border-gray-600":"text-gray-100 bg-green-800 hover:bg-green-900 border-none cursor-pointer",o),children:t})}},7566:function(e,t,n){"use strict";n.d(t,{Z:function(){return QuestionnaireForm}});var s=n(5893);n(7294);var i=n(2178),l=n(824),r=n(9258),o=n(6926),a=n(6551),d=n(6518),u=n(5777),c=n(1829),h=n(608),p=n(855);function QuestionnaireForm(e){let{section:t,answers:n,onChange:x,readOnly:f=!1}=e;return t?(0,s.jsxs)(i.Z,{sx:{p:4,mb:4},elevation:2,className:"mt-4",children:[t.title&&(0,s.jsx)(l.Z,{variant:"h5",gutterBottom:!0,className:"!font-bold text-xl !mb-4",children:t.title}),t.questions.map((e,t)=>(0,s.jsxs)(r.Z,{mb:3,children:[(0,s.jsxs)(l.Z,{variant:"subtitle1",gutterBottom:!0,className:"!text-lg !font-semibold",children:[t+1,". ",e.question]}),"opentext"===e.type&&(0,s.jsx)(o.Z,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",disabled:f,value:n[e.id]||"",onChange:t=>x(e.id,t.target.value)}),"singleselect"===e.type&&(0,s.jsx)(a.Z,{component:"fieldset",disabled:f,children:(0,s.jsx)(d.Z,{value:n[e.id]||"",onChange:t=>x(e.id,t.target.value),children:e.options.map((e,t)=>(0,s.jsx)(u.Z,{value:e,control:(0,s.jsx)(c.Z,{color:"success",disableRipple:!0,disableTouchRipple:!0,disableFocusRipple:!0}),label:e},t))})}),"multiselect"===e.type&&(0,s.jsx)(h.Z,{children:e.options.map((t,i)=>{let l=Array.isArray(n[e.id])&&n[e.id].includes(t);return(0,s.jsx)(u.Z,{control:(0,s.jsx)(p.Z,{color:"success",disableRipple:!0,disableTouchRipple:!0,disabled:f,checked:l,onChange:()=>x(e.id,null,t)}),label:t},i)})}),("text"===e.type||"number"===e.type)&&(0,s.jsx)(o.Z,{fullWidth:!0,variant:"outlined",type:e.type,disabled:f,value:n[e.id]||"",onChange:t=>x(e.id,t.target.value),InputProps:{endAdornment:e.suffix||null}})]},e.id))]}):null}},9331:function(e,t,n){"use strict";n.r(t);var s=n(5893),i=n(7294),l=n(1163),r=n(9520),o=n(6897),a=n(2594),d=n(7566),u=n(8533),c=n(4053),h=n(332);t.default=()=>{let e=(0,l.useRouter)(),{user:t}=(0,u.Z)(),{role:n}=(0,a.Z)(),p=(0,c.useSupabaseClient)(),[x,f]=(0,i.useState)([]),[m,g]=(0,i.useState)(!1),[v,b]=(0,i.useState)(null),[j,y]=(0,i.useState)({}),[k,w]=(0,i.useState)(0),handleAnswerChange=function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y(i=>{let l;let r=i[e]||{};if(null!==s){let e=Array.isArray(r[t])?r[t]:[];l=e.includes(s)?e.filter(e=>e!==s):[...e,s]}else l=n;return{...i,[e]:{...r,[t]:l}}})},handleNext=async()=>{if(k<x.length-1)w(e=>e+1),console.log(j,"answersBySection");else{let{error:n}=await p.from("users").update({questionnaire_answers:j}).eq("id",t.id);if(n){console.error("Failed saving answers:",n);return}await e.push("/profile")}},Z=x[k],getSectionsAndQuestions=async()=>{g(!0),b(null);let{data:e,error:n}=await p.from("categories").select("sectionIds").eq("id",null==t?void 0:t.role).maybeSingle();if(n||!e){b((null==n?void 0:n.message)||"Category not found"),g(!1);return}let s=e.sectionIds;if(0===s.length){f([]),g(!1);return}let{data:i,error:l}=await p.from("sections").select("*").in("id",s);if(l||!i){b((null==l?void 0:l.message)||"Failed to fetch sections"),g(!1);return}let{data:r,error:o}=await p.from("questions").select("*").in("sectionId",s);if(o||!r){b((null==o?void 0:o.message)||"Failed to fetch questions"),g(!1);return}let a=i.map(e=>({...e,questions:r.filter(t=>t.sectionId===e.id)}));f(a),g(!1)};return((0,i.useEffect)(()=>{(null==t?void 0:t.role)&&getSectionsAndQuestions()},[null==t?void 0:t.role]),m)?(0,s.jsxs)("div",{className:"flex justify-center items-center h-[75vh]",children:[(0,s.jsx)(h.Z,{className:"animate-spin text-green-800"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading..."})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Z,{title:"Onboard Questions"}),(0,s.jsxs)("div",{className:"content pt-12",children:[(0,s.jsx)("h3",{children:null==n?void 0:n.title}),(0,s.jsx)(d.Z,{section:Z,answers:j[null==Z?void 0:Z.id]||{},onChange:(e,t,n)=>handleAnswerChange(Z.id,e,t,n)}),(0,s.jsx)(o.Z,{onClick:handleNext,title:k<x.length-1?"Next":"Finish",classes:"w-full block"})]})]})}}},function(e){e.O(0,[998,264,309,816,774,888,179],function(){return e(e.s=5840)}),_N_E=e.O()}]);